<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>小牛之家</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2019-10-18T07:27:58.044Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>wcs</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>mysql 自动化脚本</title>
    <link href="http://yoursite.com/2019/10/18/mysql-%E8%87%AA%E5%8A%A8%E5%8C%96%E8%84%9A%E6%9C%AC/"/>
    <id>http://yoursite.com/2019/10/18/mysql-自动化脚本/</id>
    <published>2019-10-18T07:27:06.000Z</published>
    <updated>2019-10-18T07:27:58.044Z</updated>
    
    <content type="html"><![CDATA[<p>shell写的一个mysql自动初始化脚本</p><a id="more"></a><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/ash</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">USER="root"</span><br><span class="line">NEWUSER="xxx"</span><br><span class="line">PASSWORD="xxxx"</span><br><span class="line">NEWPASSWORD="xxxxxxxxxx"</span><br><span class="line">DATE=`date +%Y/%m/%d`</span><br><span class="line">OUTPUT="/mnt/data/database/$DATE"</span><br><span class="line">OPERATOR="export"</span><br><span class="line">FILES="/tmp/database/*"</span><br><span class="line">DATABASEPATH="/mnt/db/mysql"</span><br><span class="line">TMPPATH="/mnt/db/tmp"</span><br><span class="line">echo $OUTPUT</span><br><span class="line">[ ! -d "$OUTPUT" ] &amp;&amp; &#123;</span><br><span class="line">    echo "mkdir $OUTPUT"</span><br><span class="line">    mkdir -p $OUTPUT</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash">数据为初始化</span></span><br><span class="line">action_init()&#123;</span><br><span class="line">    flag=$(uci get -q system.@general[0].databaseinit)</span><br><span class="line">    [ ! -z "$flag" ] &amp;&amp; return</span><br><span class="line">[  -z "$flag" ] &amp;&amp; &#123;</span><br><span class="line">        section=$(uci get -q system.@general[0])</span><br><span class="line">[ -z "$section" ] &amp;&amp;&#123;</span><br><span class="line">uci add system general</span><br><span class="line">&#125;</span><br><span class="line">uci set system.@general[0].databaseinit=1</span><br><span class="line">        uci commit system</span><br><span class="line">&#125;</span><br><span class="line">    [ -d "$DATABASEPATH" ] &amp;&amp; rm -rf $DATABASEPATH</span><br><span class="line">    [ -d "$TMPPATH" ] &amp;&amp; rm -rf $TMPPATH</span><br><span class="line">    sed -i "s,^datadir.*,datadir         = \"$DATABASEPATH\",g" /etc/my.cnf</span><br><span class="line">    sed -i 's,^tmpdir.*,tmpdir          = "/mnt/db/tmp",g' /etc/my.cnf</span><br><span class="line">    [ ! -d "$DATABASEPATH" ] &amp;&amp; mkdir -p $DATABASEPATH</span><br><span class="line">    [ ! -d "$TMPPATH" ] &amp;&amp; mkdir -p $TMPPATH</span><br><span class="line">    mysql_install_db --force</span><br><span class="line">    /etc/init.d/mysqld start</span><br><span class="line">    /etc/init.d/mysqld enable</span><br><span class="line">    mysqladmin -u  $USER password "$PASSWORD"</span><br><span class="line">    [ -f /tmp/adduser.sql ] &amp;&amp; rm -rf /tmp/adduser.sql</span><br><span class="line">    echo "insert into mysql.user(Host,User,Password) values(\"localhost\",\"$NEWUSER\",password(\"$NEWPASSWORD\"));"&gt;/tmp/adduser.sql</span><br><span class="line">    echo "GRANT ALL PRIVILEGES ON *.* TO \"$NEWUSER\"@\"localhost\" IDENTIFIED BY \"$NEWPASSWORD\"; "</span><br><span class="line">    echo "GRANT ALL PRIVILEGES ON *.* TO \"$NEWUSER\"@\"localhost\" IDENTIFIED BY \"$NEWPASSWORD\"; "&gt;&gt;/tmp/adduser.sql</span><br><span class="line">    echo "flush privileges;"&gt;&gt;/tmp/adduser.sql</span><br><span class="line">    mysql -u $USER -p$PASSWORD &lt; /tmp/adduser.sql</span><br><span class="line">    rm -rf /tmp/adduser.sql</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash">数据库导出</span></span><br><span class="line">action_export()&#123;</span><br><span class="line">    databases=`mysql -u $USER -p$PASSWORD -e "SHOW DATABASES;" | tr -d "| " | grep -v Database`</span><br><span class="line">    echo "backup start"</span><br><span class="line">    for db in $databases; do</span><br><span class="line">        if [[ "$db" != "information_schema" ]] &amp;&amp; [[ "$db" != "performance_schema" ]] &amp;&amp; [[ "$db" != "mysql" ]] &amp;&amp; [[ "$db" != _* ]] ; then</span><br><span class="line">            echo "Dumping database: $db"</span><br><span class="line">            [ -f $OUTPUT/`date +%Y%m%d`.$db.sql ] &amp;&amp; &#123;</span><br><span class="line">                echo "rm sql file"</span><br><span class="line">                rm -rf $OUTPUT/`date +%Y%m%d`.$db.sql</span><br><span class="line">            &#125;</span><br><span class="line">            mysqldump -u $NEWUSER -p$NEWPASSWORD --databases $db &gt; $OUTPUT/`date +%Y%m%d`.$db.sql</span><br><span class="line">            [ -f $OUTPUT/`date +%Y%m%d`.$db.sql.gz ] &amp;&amp; &#123;</span><br><span class="line">                echo "rm file"</span><br><span class="line">                rm -rf $OUTPUT/`date +%Y%m%d`.$db.sql.gz</span><br><span class="line">            &#125;</span><br><span class="line">            gzip $OUTPUT/`date +%Y%m%d`.$db.sql</span><br><span class="line">            rm -rf $OUTPUT/`date +%Y%m%d`.$db.sql</span><br><span class="line">        fi</span><br><span class="line">    done</span><br><span class="line">    echo "backup end"</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash">数据库导入</span></span><br><span class="line">action_import()&#123;</span><br><span class="line">    for f in $FILES</span><br><span class="line">    do</span><br><span class="line">        [ -f "$f" ] &amp;&amp;&#123;</span><br><span class="line">            echo "Processing $f file..."</span><br><span class="line">            mysql -u $NEWUSER -p$NEWPASSWORD &lt; $f</span><br><span class="line">        &#125;</span><br><span class="line">    done</span><br><span class="line">&#125;</span><br><span class="line">[ ! -z "$1" ] &amp;&amp; OPERATOR=$1</span><br><span class="line">[ ! -z "$2" ] &amp;&amp; USER=$2</span><br><span class="line">[ ! -z "$3" ] &amp;&amp; PASSWORD=$3</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if [ "$OPERATOR" == "export" ]; then</span><br><span class="line">    action_export</span><br><span class="line">elif [ "$OPERATOR" == "import" ]; then</span><br><span class="line">    action_import</span><br><span class="line">elif [ "$OPERATOR" == "init" ]; then</span><br><span class="line">    action_init</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;shell写的一个mysql自动初始化脚本&lt;/p&gt;
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>Raspberry Pi 使用DS18B20温度传感器</title>
    <link href="http://yoursite.com/2019/10/18/Raspberry-Pi-%E4%BD%BF%E7%94%A8DS18B20%E6%B8%A9%E5%BA%A6%E4%BC%A0%E6%84%9F%E5%99%A8/"/>
    <id>http://yoursite.com/2019/10/18/Raspberry-Pi-使用DS18B20温度传感器/</id>
    <published>2019-10-18T07:25:43.000Z</published>
    <updated>2019-10-18T07:28:21.232Z</updated>
    
    <content type="html"><![CDATA[<p>raspberry 温度采集</p><a id="more"></a><h1 id="DS18B20-温度传感器"><a href="#DS18B20-温度传感器" class="headerlink" title="DS18B20 温度传感器"></a>DS18B20 温度传感器</h1><p>最近心血来潮的想要折腾raspberry，所以就买了一堆的传感器，现在主要讲解温度传感器的使用。</p><p>![屏幕快照 2017-05-29 下午10.31.39](<a href="http://7xrkms.com1.z0.glb.clouddn.com/屏幕快照" target="_blank" rel="noopener">http://7xrkms.com1.z0.glb.clouddn.com/屏幕快照</a> 2017-05-29 下午10.31.39.png)</p><p><img src="http://7xrkms.com1.z0.glb.clouddn.com/14960683305689.png" alt=""></p><p>Pin1(GND)接到 P1-06(GND)<br>Pin2(DQ)接到 P1-07(GPIO4)<br>Pin3(VCC)接到P1-01(3.3v)</p><p>为了能够让系统正确的识别传感器，我们需要对<strong>/boot/config.txt</strong>文件进行编辑</p><blockquote><p>sudo vim /boot/config.txt</p></blockquote><p>在文件的未必添加下面的语句</p><blockquote><p>dtoverlay=w1-gpio,gpiopin=4</p></blockquote><p>添加完成之后我们重启raspberry</p><blockquote><p>sudo reboot</p></blockquote><p>重启完成之后我们需要进行/sys/bus/w1/devices目录</p><blockquote><p>cd /sys/bus/w1/devices</p></blockquote><p>通过调用ls命令，我们发现这个目录会有类似28-0416b3b833ff这样的一个目录，这个目录名称并是你传感器的ID，.在目录下面会有一个w1_slave文件，我们通过调用 cat命令可以读取到传感器的实时数据。</p><blockquote><p>cd 28-0416b3b833ff<br>ls<br>cat w1_slave</p></blockquote><p>完整的命令如下图所示<br>![屏幕快照 2017-05-29 下午10.42.01](<a href="http://7xrkms.com1.z0.glb.clouddn.com/屏幕快照" target="_blank" rel="noopener">http://7xrkms.com1.z0.glb.clouddn.com/屏幕快照</a> 2017-05-29 下午10.42.01.png)<br>其中t=30312是我实际测量到温度值，在上面的图中的温度为30.312度</p><p>同时我们可以利用python脚本来读取数据</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gettemp</span><span class="params">(id)</span>:</span></span><br><span class="line">  <span class="keyword">try</span>:</span><br><span class="line">    mytemp = <span class="string">''</span></span><br><span class="line">    filename = <span class="string">'w1_slave'</span></span><br><span class="line">    f = open(<span class="string">'/sys/bus/w1/devices/'</span> + id + <span class="string">'/'</span> + filename, <span class="string">'r'</span>)</span><br><span class="line">    line = f.readline() <span class="comment"># read 1st line</span></span><br><span class="line">    crc = line.rsplit(<span class="string">' '</span>,<span class="number">1</span>)</span><br><span class="line">    crc = crc[<span class="number">1</span>].replace(<span class="string">'\n'</span>, <span class="string">''</span>)</span><br><span class="line">    <span class="keyword">if</span> crc==<span class="string">'YES'</span>:</span><br><span class="line">      line = f.readline() <span class="comment"># read 2nd line</span></span><br><span class="line">      mytemp = line.rsplit(<span class="string">'t='</span>,<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">      mytemp = <span class="number">99999</span></span><br><span class="line">    f.close()</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> int(mytemp[<span class="number">1</span>])</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">except</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="number">99999</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line"> </span><br><span class="line">  <span class="comment"># Script has been called directly</span></span><br><span class="line">  id = <span class="string">'28-0416b3b833ff'</span></span><br><span class="line">  <span class="keyword">print</span> <span class="string">"Temp : "</span> + <span class="string">'&#123;:.3f&#125;'</span>.format(gettemp(id)/float(<span class="number">1000</span>))</span><br></pre></td></tr></table></figure><p>我们通过命令行调用，得到如类似下面的结果</p><p>![屏幕快照 2017-05-29 下午10.48.50](<a href="http://7xrkms.com1.z0.glb.clouddn.com/屏幕快照" target="_blank" rel="noopener">http://7xrkms.com1.z0.glb.clouddn.com/屏幕快照</a> 2017-05-29 下午10.48.50.png)</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;raspberry 温度采集&lt;/p&gt;
    
    </summary>
    
    
    
      <category term="raspberry" scheme="http://yoursite.com/tags/raspberry/"/>
    
  </entry>
  
  <entry>
    <title>ts 实现混合类</title>
    <link href="http://yoursite.com/2019/10/18/ts-%E5%AE%9E%E7%8E%B0%E6%B7%B7%E5%90%88%E7%B1%BB/"/>
    <id>http://yoursite.com/2019/10/18/ts-实现混合类/</id>
    <published>2019-10-18T07:05:47.000Z</published>
    <updated>2019-10-18T07:12:12.278Z</updated>
    
    <content type="html"><![CDATA[<p>ts混合类特性</p><a id="more"></a><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mammal</span></span>&#123;</span><br><span class="line">    breathe():string&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"I'm alive!"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WingedAnimal</span> </span>&#123;</span><br><span class="line">    fly() :string&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"I can fly!"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bat</span> <span class="title">implements</span> <span class="title">Mammal</span>,<span class="title">WingedAnimal</span></span>&#123;</span><br><span class="line">    breathe:<span class="function"><span class="params">()</span>=&gt;</span>string;</span><br><span class="line">    fly: <span class="function"><span class="params">()</span> =&gt;</span> string;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">applyMixins</span>(<span class="params">derivedCtor:any,baseCtors:any[]</span>)</span>&#123;</span><br><span class="line">    baseCtors.forEach(<span class="function"><span class="params">baseCtor</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="built_in">Object</span>.getOwnPropertyNames(baseCtor.prototype).forEach(<span class="function"><span class="params">name</span>=&gt;</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(name!==<span class="string">'constructor'</span>)&#123;</span><br><span class="line">                derivedCtor.prototype[name]=baseCtor.prototype[name];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">applyMixins(Bat,[Mammal,WingedAnimal])</span><br><span class="line"><span class="keyword">var</span> bat=<span class="keyword">new</span> Bat();</span><br><span class="line"><span class="built_in">console</span>.log(bat.breathe());</span><br><span class="line"><span class="built_in">console</span>.log(bat.fly());</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ts混合类特性&lt;/p&gt;
    
    </summary>
    
    
    
      <category term="typescript" scheme="http://yoursite.com/tags/typescript/"/>
    
  </entry>
  
  <entry>
    <title>es6 模板字符串</title>
    <link href="http://yoursite.com/2017/07/27/es6-%E6%A8%A1%E6%9D%BF%E5%AD%97%E7%AC%A6%E4%B8%B2/"/>
    <id>http://yoursite.com/2017/07/27/es6-模板字符串/</id>
    <published>2017-07-27T02:02:14.000Z</published>
    <updated>2019-10-18T03:40:31.362Z</updated>
    
    <content type="html"><![CDATA[<p>es6 新的特殊支持嵌入表达式，自动会处于``内所有的字符串。</p><a id="more"></a><h3 id="多行字符串"><a href="#多行字符串" class="headerlink" title="多行字符串"></a>多行字符串</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">\\传统的多行字符串</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'string line1 \n\</span></span><br><span class="line"><span class="string">string line2'</span>)</span><br><span class="line">\\es6多行字符串</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`string line</span></span><br><span class="line"><span class="string">string lin2`</span>);</span><br></pre></td></tr></table></figure><h3 id="表达式插入"><a href="#表达式插入" class="headerlink" title="表达式插入"></a>表达式插入</h3><p>传统的方式采用的是字符串拼接的方式进行，通过+号进行拼接</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 传统方式</span></span><br><span class="line"> <span class="keyword">let</span> x=<span class="number">1</span>;</span><br><span class="line"> <span class="keyword">let</span> y=<span class="number">2</span>;</span><br><span class="line"> <span class="built_in">console</span>.log(<span class="string">'x='</span>+(a+b)+<span class="string">';y='</span>+(a*b))</span><br><span class="line"> <span class="comment">//es6 语法</span></span><br><span class="line"> <span class="built_in">console</span>.log(<span class="string">'x='</span>+(a+b)+<span class="string">';y='</span>+(a*b));</span><br><span class="line"> <span class="built_in">console</span>.log(<span class="string">`x=<span class="subst">$&#123;x+y&#125;</span>,y=<span class="subst">$&#123;x*y&#125;</span>`</span>);</span><br></pre></td></tr></table></figure><h3 id="带标签的模板字符串"><a href="#带标签的模板字符串" class="headerlink" title="带标签的模板字符串"></a>带标签的模板字符串</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//strings 存放所有的字符串字面的数组</span></span><br><span class="line"><span class="comment">//values 存放第一个数组紧随的参数</span></span><br><span class="line"> <span class="function"><span class="keyword">function</span> <span class="title">tag3</span>(<span class="params">strings,...values</span>)</span>&#123;</span><br><span class="line">   <span class="keyword">let</span> a = <span class="number">5</span>;</span><br><span class="line">  <span class="keyword">let</span> b = <span class="number">10</span>;</span><br><span class="line">                <span class="built_in">console</span>.log(strings[<span class="number">0</span>]);<span class="comment">//hello</span></span><br><span class="line">                <span class="built_in">console</span>.log(strings[<span class="number">1</span>]);<span class="comment">//world</span></span><br><span class="line">                <span class="built_in">console</span>.log(strings[<span class="number">2</span>]);<span class="comment">//</span></span><br><span class="line">                <span class="built_in">console</span>.log(values[<span class="number">0</span>]);<span class="comment">//15</span></span><br><span class="line">                <span class="built_in">console</span>.log(values[<span class="number">1</span>]);<span class="comment">//50</span></span><br><span class="line">                <span class="keyword">return</span> <span class="string">"hello world"</span></span><br><span class="line"> &#125;</span><br><span class="line">  tag3 <span class="string">`Hello <span class="subst">$&#123;a+b&#125;</span> world <span class="subst">$&#123; a*b &#125;</span>`</span>;</span><br><span class="line">  <span class="comment">//out:hello world</span></span><br></pre></td></tr></table></figure><p>通过传入的参数来返回一个函数</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">template</span>(<span class="params">strings,...keys</span>)</span>&#123;</span><br><span class="line"><span class="keyword">return</span> (<span class="function"><span class="keyword">function</span>(<span class="params">...values</span>)</span>&#123;</span><br><span class="line"><span class="keyword">var</span> dict=values[values.length<span class="number">-1</span>]||&#123;&#125;;  <span class="comment">//A                 </span></span><br><span class="line"><span class="keyword">var</span> result=[strings[<span class="number">0</span>]];</span><br><span class="line">keys.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">key,i</span>)</span>&#123;</span><br><span class="line"><span class="keyword">var</span> value=<span class="built_in">Number</span>.isInteger(key)?values[key]:dict[key];              result.push(value,strings[i+<span class="number">1</span>]);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">return</span> result.join(<span class="string">' '</span>);</span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> t1Closure=template <span class="string">`<span class="subst">$&#123;<span class="number">0</span>&#125;</span><span class="subst">$&#123;<span class="number">1</span>&#125;</span><span class="subst">$&#123;<span class="number">0</span>&#125;</span>!`</span>;<span class="comment">//返回的是一个函数</span></span><br><span class="line"><span class="built_in">console</span>.log(t1Closure(<span class="string">'Y'</span>,<span class="string">'A'</span>));<span class="comment">//Y A Y</span></span><br></pre></td></tr></table></figure><h3 id="不转义字符串"><a href="#不转义字符串" class="headerlink" title="不转义字符串"></a>不转义字符串</h3><p>在String.raw()输出不转义的字符串,输出原始的字符串</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">tag</span>(<span class="params">strings, ...values</span>) </span>&#123;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">倘若不采用raw输出的会直接进行换行 </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">  <span class="built_in">console</span>.log(strings.raw[<span class="number">0</span>]); </span><br><span class="line">  <span class="comment">// "string text line 1 \n string text line 2"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">tag<span class="string">`string text line 1 \n string text line 2`</span>;</span><br></pre></td></tr></table></figure><h4 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//判断是否具有权限，倘若没有抛出一个异常</span></span><br><span class="line"><span class="comment">//$&#123;user.name&#125;和$&#123;action&#125;是两个点占位号，会自动将值带入到该字符串</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">authorize</span>(<span class="params">user, action</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!user.hasPrivilege(action)) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(</span><br><span class="line">      <span class="string">`用户 <span class="subst">$&#123;user.name&#125;</span> 未被授权执行 <span class="subst">$&#123;action&#125;</span> 操作。`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;es6 新的特殊支持嵌入表达式，自动会处于``内所有的字符串。&lt;/p&gt;
    
    </summary>
    
    
    
      <category term="node.js" scheme="http://yoursite.com/tags/node-js/"/>
    
  </entry>
  
  <entry>
    <title>meteor 加载静态文件</title>
    <link href="http://yoursite.com/2017/07/27/meteor-%E5%8A%A0%E8%BD%BD%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6/"/>
    <id>http://yoursite.com/2017/07/27/meteor-加载静态文件/</id>
    <published>2017-07-27T01:54:17.000Z</published>
    <updated>2019-10-18T04:50:46.119Z</updated>
    
    <content type="html"><![CDATA[<p>meteor 加载静态文件</p><a id="more"></a><h1 id="meteor-加载外部资源文件"><a href="#meteor-加载外部资源文件" class="headerlink" title="meteor 加载外部资源文件"></a>meteor 加载外部资源文件</h1><p>在很多时候开发的时候我们需要导入一些外部的数据到程序当中，这些数据可能存放在csv,XML.json之类的文件当中，我们就将其导入到程序当中，使其能够供全局进行访问。</p><p><strong>private/json/city.json</strong></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line"> &#123;<span class="attr">"code"</span>:<span class="string">"010"</span>,<span class="attr">"city"</span>:<span class="string">"北京"</span>, <span class="attr">"pinyin"</span>: <span class="string">"beijing"</span>&#125;,</span><br><span class="line"> &#123;<span class="attr">"code"</span>:<span class="string">"021"</span>,<span class="attr">"city"</span>:<span class="string">"上海"</span>, <span class="attr">"pinyin"</span>:<span class="string">"shanghai"</span>&#125;,</span><br><span class="line"> &#123;<span class="attr">"code"</span>:<span class="string">"0571"</span>,<span class="attr">"city"</span>:<span class="string">"杭州"</span>, <span class="attr">"pinyin"</span>:<span class="string">"hangzhou"</span>,<span class="attr">"province"</span>: <span class="string">"浙江"</span>&#125;,</span><br><span class="line"> &#123;<span class="attr">"code"</span>:<span class="string">"0574"</span>,<span class="attr">"city"</span>:<span class="string">"宁波"</span>, <span class="attr">"pinyin"</span>:<span class="string">"ningbo"</span>,<span class="attr">"province"</span>: <span class="string">"浙江"</span>&#125;,</span><br><span class="line"> &#123;<span class="attr">"code"</span>:<span class="string">"0573"</span>,<span class="attr">"city"</span>:<span class="string">"嘉兴"</span>, <span class="attr">"pinyin"</span>:<span class="string">"jiaxing"</span>,<span class="attr">"province"</span>: <span class="string">"浙江"</span>&#125;,</span><br><span class="line"> &#123;<span class="attr">"code"</span>:<span class="string">"0575"</span>,<span class="attr">"city"</span>:<span class="string">"绍兴"</span>, <span class="attr">"pinyin"</span>:<span class="string">"shaoxing"</span>,<span class="attr">"province"</span>: <span class="string">"浙江"</span>&#125;,</span><br><span class="line"> &#123;<span class="attr">"code"</span>:<span class="string">"0577"</span>,<span class="attr">"city"</span>:<span class="string">"温州"</span>, <span class="attr">"pinyin"</span>:<span class="string">"wenzhou"</span>,<span class="attr">"province"</span>: <span class="string">"浙江"</span>&#125;,</span><br><span class="line"> &#123;<span class="attr">"code"</span>:<span class="string">"0580"</span>,<span class="attr">"city"</span>:<span class="string">"舟山"</span>, <span class="attr">"pinyin"</span>:<span class="string">"zhoushan"</span>,<span class="attr">"province"</span>: <span class="string">"浙江"</span>&#125;,</span><br><span class="line"> &#123;<span class="attr">"code"</span>:<span class="string">"0572"</span>,<span class="attr">"city"</span>:<span class="string">"湖州"</span>, <span class="attr">"pinyin"</span>:<span class="string">"huzhou"</span>,<span class="attr">"province"</span>: <span class="string">"浙江"</span>&#125;,</span><br><span class="line"> &#123;<span class="attr">"code"</span>:<span class="string">"0579"</span>,<span class="attr">"city"</span>:<span class="string">"金华"</span>, <span class="attr">"pinyin"</span>:<span class="string">"jinhua"</span>,<span class="attr">"province"</span>: <span class="string">"浙江"</span>&#125;,</span><br><span class="line"> &#123;<span class="attr">"code"</span>:<span class="string">"0578"</span>,<span class="attr">"city"</span>:<span class="string">"丽水"</span>, <span class="attr">"pinyin"</span>:<span class="string">"lishui"</span>,<span class="attr">"province"</span>: <span class="string">"浙江"</span>&#125;,</span><br><span class="line"> &#123;<span class="attr">"code"</span>:<span class="string">"0576"</span>,<span class="attr">"city"</span>:<span class="string">"台州"</span>, <span class="attr">"pinyin"</span>:<span class="string">"taizhou"</span>,<span class="attr">"province"</span>: <span class="string">"浙江"</span>&#125;,</span><br><span class="line"> &#123;<span class="attr">"code"</span>:<span class="string">"0570"</span>,<span class="attr">"city"</span>:<span class="string">"衢州"</span>, <span class="attr">"pinyin"</span>:<span class="string">"quzhou"</span>,<span class="attr">"province"</span>: <span class="string">"浙江"</span>&#125;,</span><br><span class="line"> ]</span><br></pre></td></tr></table></figure><blockquote><p>特殊注意是private文件夹的数据是不提供给客户端</p></blockquote><p>上面的是包含城市名称以及区号的json数据，我们将其保存在文件当中，这里我们可以通过Assets API来访问以及处理相应的数据。</p><p><strong>server/main.js</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Meteor &#125; <span class="keyword">from</span> <span class="string">'meteor/meteor'</span>;</span><br><span class="line"></span><br><span class="line">Meteor.startup(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> cityList=<span class="built_in">JSON</span>.parse(Assets.getText(<span class="string">'json/city.json'</span>))</span><br><span class="line">  _.each(cityList, <span class="function"><span class="keyword">function</span>(<span class="params">city</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(city);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>上面的代码会将所有的数据进行输出，但是有的时候这些数据可以会被其他的项目需要，这里我们需要通过添加一个package来解决，同时我们只可以将这个包上传到<a href="https://atmospherejs.com" target="_blank" rel="noopener">atmospherejs</a><br>我们需要将之前的json文件移到cityjson包，最终的目录文件如下所示</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">└── cityjson</span><br><span class="line">    ├── README.md</span><br><span class="line">    ├── city.json</span><br><span class="line">    ├── cityjson-tests.js</span><br><span class="line">    ├── cityjson.js</span><br><span class="line">    └── package.js</span><br></pre></td></tr></table></figure><p><strong>package.js</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">Package.describe(&#123;</span><br><span class="line">  name: <span class="string">'wenchangshou:cityjson'</span>,</span><br><span class="line">  version: <span class="string">'0.0.1'</span>,</span><br><span class="line">  <span class="comment">// Brief, one-line summary of the package.</span></span><br><span class="line">  summary: <span class="string">'获取国内的所有的城市名称以及区号'</span>,</span><br><span class="line">  <span class="comment">// URL to the Git repository containing the source code for this package.</span></span><br><span class="line">  git: <span class="string">''</span>,</span><br><span class="line">  <span class="comment">// By default, Meteor will default to using README.md for documentation.</span></span><br><span class="line">  <span class="comment">// To avoid submitting documentation, set this field to null.</span></span><br><span class="line">  documentation: <span class="string">'README.md'</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">Package.onUse(<span class="function"><span class="keyword">function</span> (<span class="params">api</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//  api.versionsFrom('1.4.2.7');</span></span><br><span class="line">  api.versionsFrom(<span class="string">'1.0'</span>)</span><br><span class="line">  api.export(<span class="string">'cityList'</span>, <span class="string">'server'</span>);</span><br><span class="line">  api.addAssets(<span class="string">'city.json'</span>, <span class="string">'server'</span>)</span><br><span class="line">  api.addFiles(<span class="string">'cityjson.js'</span>, <span class="string">'server'</span>)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Package.onTest(<span class="function"><span class="keyword">function</span>(<span class="params">api</span>) </span>&#123;</span><br><span class="line">  api.use(<span class="string">'ecmascript'</span>);</span><br><span class="line">  api.use(<span class="string">'tinytest'</span>);</span><br><span class="line">  api.use(<span class="string">'wenchangshou:cityjson'</span>);</span><br><span class="line">  api.mainModule(<span class="string">'cityjson-tests.js'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><strong>cityjson.js</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> cityCollection=<span class="built_in">JSON</span>.parse(Assets.getText(<span class="string">'city.json'</span>));</span><br><span class="line">cityList=&#123;<span class="attr">city</span>:cityCollection&#125;</span><br></pre></td></tr></table></figure><ul><li>Assets.getText 可以从当前的包内进行调用 ，通过addFiles进行数据的暴露</li><li>之后我们需要读取以及解析数据，city里面包含了所有的城市信息，并且我们通过cityList这个全局变量进行数据的暴露</li><li>我们通过 api.addAssets将静态的文件导入到包中，通过Assets.getText进行访问</li></ul><h3 id="meteor-包上传"><a href="#meteor-包上传" class="headerlink" title="meteor 包上传"></a>meteor 包上传</h3><p>上面的操作我们已经创建了一个能够使用的包了，这时候我们需要将这个包上传，方便将来的使用</p><blockquote><p>meteor publish –create </p></blockquote><p>上传成功之后我们可以直接访问<a href="https://atmospherejs.com/wenchangshou/cityjson" target="_blank" rel="noopener">cityjson</a>来查看我们上传的包，如下图所示<br>![屏幕快照 2017-02-18 下午5.37.22](<a href="http://o7ez1faxc.bkt.clouddn.com/2017-02-18-屏幕快照" target="_blank" rel="noopener">http://o7ez1faxc.bkt.clouddn.com/2017-02-18-屏幕快照</a> 2017-02-18 下午5.37.22.png)</p><p>上传成功之后我们将pckages/cityjson目录删除</p><blockquote><p>rm -rf packages/cityjson</p></blockquote><p>我们在主目录当中添加我们上传的包,其中wenchangshou是我的用户名</p><blockquote><p>meteor add wenchangshou:cityjson</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;meteor 加载静态文件&lt;/p&gt;
    
    </summary>
    
    
    
      <category term="node" scheme="http://yoursite.com/tags/node/"/>
    
  </entry>
  
</feed>
